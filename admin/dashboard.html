
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alphadome Admin Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    body { font-family: 'Inter', system-ui, Arial, sans-serif; background: linear-gradient(120deg, #181c2f 0%, #232a4d 100%); color: #e6e8ee; min-height: 100vh; }
    .sidebar { background: #15182b; min-height: 100vh; border-right: 1px solid #232a4d; transition: width 0.2s, left 0.2s; box-shadow: 2px 0 12px 0 rgba(30,39,71,0.08); }
    .sidebar .logo { font-size: 2rem; font-weight: 700; color: #a5eaff; margin: 32px 0 32px 0; letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
    .sidebar .nav-link { color: #b7bfd4; font-weight: 600; font-size: 1.08rem; border-left: 4px solid transparent; transition: all 0.2s; border-radius: 0 8px 8px 0; margin: 2px 0; }
    .sidebar .nav-link.active, .sidebar .nav-link:hover { color: #fff; background: #232a4d; border-left: 4px solid #4f46e5; box-shadow: 0 2px 8px 0 rgba(79,70,229,0.10); }
    .topbar { background: #232a4d; color: #a5eaff; padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px 0 rgba(30,39,71,0.08); }
    .topbar .user { font-size: 1.1rem; color: #b7bfd4; display: flex; align-items: center; gap: 10px; }
    .dashboard-cards { display: flex; flex-wrap: wrap; gap: 24px; margin-top: 32px; justify-content: flex-start; }
    .dashboard-card { background: #181c2f; border-radius: 18px; border: 1px solid #232a4d; box-shadow: 0 2px 16px 0 rgba(30,39,71,0.10); padding: 32px 24px 28px 24px; flex: 1 1 220px; min-width: 180px; max-width: 340px; transition: box-shadow 0.2s, transform 0.2s; margin-bottom: 8px; }
    .dashboard-card:hover { box-shadow: 0 4px 32px 0 rgba(30,39,71,0.18); transform: translateY(-2px) scale(1.03); }
    .dashboard-card h3 { color: #38bdf8; font-size: 1.18rem; margin-bottom: 12px; letter-spacing: 0.5px; }
    .dashboard-card .value { font-size: 2.3rem; font-weight: 700; color: #a5eaff; margin-bottom: 4px; }
    .dashboard-card .desc { color: #b7bfd4; font-size: 1.04rem; margin-bottom: 0; }
    .main-content { margin-left: 0; padding: 32px 5vw 32px 5vw; max-width: 1200px; width: 100%; transition: margin-left 0.2s; }
    @media (min-width: 1200px) { .main-content { max-width: 1400px; } }
    @media (min-width: 992px) { .main-content { margin-left: 260px; } .sidebar { width: 260px; position: fixed; left: 0; top: 0; z-index: 10; } }
    @media (max-width: 991px) {
      .sidebar { width: 100vw; position: fixed; left: 0; top: 0; z-index: 20; height: 60px; flex-direction: row; align-items: center; justify-content: space-between; padding: 0 16px; box-shadow: none; }
      .sidebar .logo { margin: 0; font-size: 1.3rem; }
      .sidebar .nav { flex-direction: row; gap: 8px; }
      .main-content { margin-left: 0; padding: 24px 2vw 24px 2vw; }
      .dashboard-cards { gap: 12px; }
      .dashboard-card { min-width: 140px; max-width: 100vw; padding: 20px 10px 16px 10px; }
    }
    .nav-link[aria-current="page"] { color: #fff !important; background: #232a4d !important; border-left: 4px solid #4f46e5 !important; }
    /* Extra polish for mobile sidebar overlay */
    #sidebarOverlay { transition: background 0.2s; }
  </style>
</head>
<body>
  <div class="topbar d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-link text-light d-lg-none" id="sidebarToggle" aria-label="Toggle menu"><i class="fa fa-bars"></i></button>
      <span class="logo"><i class="fa-solid fa-cube"></i> Alphadome</span>
    </div>
    <div class="user"><i class="fa-solid fa-user-shield"></i> Admin</div>
  </div>
  <div class="d-flex">
    <nav class="sidebar flex-column p-0 d-lg-flex d-none" id="sidebarNav">
      <div class="logo d-none d-lg-flex"><i class="fa-solid fa-cube"></i> Alphadome</div>
      <ul class="nav flex-column w-100">
        <li class="nav-item"><a class="nav-link active" href="#dashboard"><i class="fa-solid fa-gauge"></i> Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="#upload"><i class="fa-solid fa-upload"></i> Upload</a></li>
        <li class="nav-item"><a class="nav-link" href="#simple"><i class="fa-solid fa-plus"></i> Simple Upload</a></li>
        <li class="nav-item"><a class="nav-link" href="#catalog"><i class="fa-solid fa-table-list"></i> Catalog Viewer</a></li>
        <li class="nav-item"><a class="nav-link" href="#logs"><i class="fa-solid fa-wave-square"></i> Live Logs</a></li>
      </ul>
    </nav>
    <main class="main-content flex-grow-1">
      <div id="spa-content">
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-users"></i> Tenants</h3>
            <div class="value" id="tenantCount">--</div>
            <div class="desc">Active tenants</div>
          </div>
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-robot"></i> LLM Usage</h3>
            <div class="value" id="llmUsage">--</div>
            <div class="desc">LLM requests (24h)</div>
          </div>
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-bug"></i> Errors</h3>
            <div class="value" id="errorCount">--</div>
            <div class="desc">Errors (24h)</div>
          </div>
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-heart-pulse"></i> Health</h3>
            <div class="value" id="healthStatus">--</div>
            <div class="desc">System health</div>
          </div>
        </div>
        <div class="mt-5">
          <h2>Welcome to the Alphadome Admin Portal</h2>
          <p class="text-muted">Use the sidebar to manage tenants, upload catalogs, view logs, and monitor LLM usage. All features are optimized for desktop and mobile.</p>
        </div>
      </div>
    </main>
    <!-- Mobile sidebar overlay -->
    <div id="sidebarOverlay" class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-lg-none d-none" style="z-index:1050;"></div>
    <nav class="sidebar flex-column p-0 d-lg-none d-none position-fixed top-0 start-0 w-75 h-100" id="mobileSidebar" style="z-index:1100;">
      <div class="logo"><i class="fa-solid fa-cube"></i> Alphadome</div>
      <ul class="nav flex-column w-100">
        <li class="nav-item"><a class="nav-link active" href="#dashboard"><i class="fa-solid fa-gauge"></i> Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="#upload"><i class="fa-solid fa-upload"></i> Upload</a></li>
        <li class="nav-item"><a class="nav-link" href="#simple"><i class="fa-solid fa-plus"></i> Simple Upload</a></li>
        <li class="nav-item"><a class="nav-link" href="#catalog"><i class="fa-solid fa-table-list"></i> Catalog Viewer</a></li>
        <li class="nav-item"><a class="nav-link" href="#logs"><i class="fa-solid fa-wave-square"></i> Live Logs</a></li>
      </ul>
    </nav>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Responsive sidebar toggle for mobile
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const mobileSidebar = document.getElementById('mobileSidebar');
    function openMobileSidebar() {
      mobileSidebar.classList.remove('d-none');
      sidebarOverlay.classList.remove('d-none');
      document.body.style.overflow = 'hidden';
    }
    function closeMobileSidebar() {
      mobileSidebar.classList.add('d-none');
      sidebarOverlay.classList.add('d-none');
      document.body.style.overflow = '';
    }
    sidebarToggle.addEventListener('click', openMobileSidebar);
    sidebarOverlay.addEventListener('click', closeMobileSidebar);
    // Close sidebar on nav click (mobile)
    mobileSidebar.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', closeMobileSidebar);
    });
    // SPA navigation (desktop and mobile) - event delegation for robust handling
    function setActiveNav(hash) {
      document.querySelectorAll('.sidebar .nav-link').forEach(l => {
        if (l.getAttribute('href') === hash) l.classList.add('active');
        else l.classList.remove('active');
      });
    }
    function handleNavClick(e) {
      const link = e.target.closest('.nav-link');
      if (link) {
        e.preventDefault();
        const hash = link.getAttribute('href');
        if (window.location.hash !== hash) {
          window.location.hash = hash;
        } else {
          // If already on this hash, force reload
          loadPage(hash);
        }
        setActiveNav(hash);
        // Close mobile sidebar if open
        closeMobileSidebar();
      }
    }
    // Attach event listeners to both sidebars
    document.getElementById('sidebarNav').addEventListener('click', handleNavClick);
    document.getElementById('mobileSidebar').addEventListener('click', handleNavClick);
    // On hashchange, update content and active nav
    function handleHashChange() {
      const hash = window.location.hash || '#dashboard';
      setActiveNav(hash);
      loadPage(hash);
    }
    window.addEventListener('hashchange', handleHashChange);
    // Initial load
    handleHashChange();
    // SPA page loader
    async function loadPage(hash) {
      const spaContent = document.getElementById('spa-content');
      spaContent.innerHTML = `<div class='text-center p-5'><div class='spinner-border text-info'></div><div>Loading...</div></div>`;
      let url = '';
      if (hash === '#catalog') url = 'catalog.html';
      else if (hash === '#simple') url = 'simple_upload.html';
      else if (hash === '#upload') url = 'dashboard.html#upload';
      else if (hash === '#logs') url = '/logs/live';
      else if (hash === '#dashboard' || hash === '' || hash === '#') url = '';
      else url = '';
      if (url.endsWith('.html')) {
        try {
          const resp = await fetch(url);
          if (!resp.ok) throw new Error('Not found');
          let html = await resp.text();
          // Extract <body> content only
          html = html.match(/<body[^>]*>([\s\S]*?)<\/body>/i)?.[1] || html;
          spaContent.innerHTML = html;
        } catch (e) {
          spaContent.innerHTML = `<div class='text-center p-5 text-danger'><h2>Failed to load page.</h2><div class='mt-2'>Please check the link or contact support.</div></div>`;
        }
      } else if (hash === '#dashboard' || hash === '' || hash === '#') {
        // Default dashboard
        spaContent.innerHTML = `
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-users"></i> Tenants</h3>
            <div class="value" id="tenantCount">--</div>
            <div class="desc">Active tenants</div>
          </div>
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-robot"></i> LLM Usage</h3>
            <div class="value" id="llmUsage">--</div>
            <div class="desc">LLM requests (24h)</div>
          </div>
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-bug"></i> Errors</h3>
            <div class="value" id="errorCount">--</div>
            <div class="desc">Errors (24h)</div>
          </div>
          <div class="dashboard-card">
            <h3><i class="fa-solid fa-heart-pulse"></i> Health</h3>
            <div class="value" id="healthStatus">--</div>
            <div class="desc">System health</div>
          </div>
        </div>
        <div class="mt-5">
          <h2>Welcome to the Alphadome Admin Portal</h2>
          <p class="text-muted">Use the sidebar to manage tenants, upload catalogs, view logs, and monitor LLM usage. All features are optimized for desktop and mobile.</p>
        </div>
        `;
      } else if (hash === '#logs') {
        // For logs, open in new tab for now
        window.open('/logs/live', '_blank');
        spaContent.innerHTML = `<div class='text-center p-5'><h2>Logs opened in new tab.</h2></div>`;
      } else {
        spaContent.innerHTML = `<div class='text-center p-5 text-danger'><h2>Page not found or broken link.</h2><div class='mt-2'>Please check the link or contact support.</div></div>`;
      }
    }
    // Fetch dashboard stats via AJAX and update cards
    async function updateDashboardCards() {
      try {
        // Example endpoints, replace with your actual API endpoints
        const [tenants, llm, errors, health] = await Promise.all([
          fetch('/admin/api/tenants/active').then(r => r.json()).catch(() => ({count: '--'})),
          fetch('/admin/api/llm/usage').then(r => r.json()).catch(() => ({count: '--'})),
          fetch('/admin/api/errors/count').then(r => r.json()).catch(() => ({count: '--'})),
          fetch('/admin/api/health').then(r => r.json()).catch(() => ({status: '--'})),
        ]);
        document.getElementById('tenantCount')?.innerText = tenants.count ?? '--';
        document.getElementById('llmUsage')?.innerText = llm.count ?? '--';
        document.getElementById('errorCount')?.innerText = errors.count ?? '--';
        document.getElementById('healthStatus')?.innerText = health.status ?? '--';
      } catch (e) {
        // fallback: do nothing
      }
    }
    // Run on dashboard load
    if (window.location.hash === '' || window.location.hash === '#' || window.location.hash === '#dashboard') {
      updateDashboardCards();
    }
    // Also run when dashboard is loaded via SPA
    window.addEventListener('hashchange', () => {
      if (window.location.hash === '' || window.location.hash === '#' || window.location.hash === '#dashboard') {
        setTimeout(updateDashboardCards, 200);
      }
    });
  </script>
</body>
</html>
    <div class="card">
      <h2 style="margin-top:0; color:#38bdf8;">Simple Upload (No SKU/CSV)</h2>
      <div class="muted">Step 4 (alternative): Use this for quick product uploads without a full catalog.</div>
      <form id="simpleForm">
        <div class="row">
          <div>
            <label>Admin Key</label>
            <input name="admin_key" placeholder="ADMIN_PASS" required />
          </div>
          <div>
            <label>Tenant Phone</label>
            <input name="tenant_phone" placeholder="0702245555" />
          </div>
        </div>
        <label>Tenant Name (optional)</label>
        <input name="tenant_name" placeholder="Kassangas Music Shop" />
        <div class="row">
          <div>
            <label>Product Name</label>
            <input name="name" placeholder="Studio Headphones" required />
          </div>
          <div>
            <label>Price (KES)</label>
            <input name="price" type="number" step="0.01" placeholder="8200" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Stock Count</label>
            <input name="stock_count" type="number" placeholder="6" />
          </div>
          <div>
            <label>Category</label>
            <input name="category" placeholder="audio" />
          </div>
        </div>
        <label>Tags (comma-separated)</label>
        <input name="tags" placeholder="headphones,studio" />
        <label>Brand</label>
        <input name="brand" placeholder="Kassangas" />
        <label>Description</label>
        <textarea name="description" rows="3"></textarea>
        <label>Collection (optional)</label>
        <input name="collection" placeholder="Featured" />
        <label>Collection Description (optional)</label>
        <input name="collection_description" placeholder="Top picks and best sellers" />
        <label>Images (drag & drop)</label>
        <input name="images" type="file" multiple />
        <button type="submit"><i class="fa-solid fa-plus"></i> Upload (Autoâ€‘SKU)</button>
      </form>
    </div>
    <div class="card">
      <h2 style="margin-top:0; color:#38bdf8;">CSV Import</h2>
      <div class="muted">Step 4 (alternative): Import a full catalog from CSV.</div>
      <form id="csvForm">
        <div class="row">
          <div>
            <label>Admin Key</label>
            <input name="admin_key" placeholder="ADMIN_PASS" required />
          </div>
          <div>
            <label>Tenant Phone</label>
            <input name="tenant_phone" placeholder="0702245555" />
          </div>
        </div>
        <label>Tenant Name (optional)</label>
        <input name="tenant_name" placeholder="Kassangas Music Shop" />
        <label>Catalog CSV</label>
        <input name="catalog_csv" type="file" accept=".csv" required />
        <div class="muted">Columns: sku,name,description,price,currency,stock_count,image_url,category,tags,brand,collection,collection_description</div>
        <button type="submit"><i class="fa-solid fa-file-csv"></i> Import CSV</button>
      </form>
    </div>
    <div class="card">
      <h2 style="margin-top:0; color:#38bdf8;">Response</h2>
      <pre id="response"></pre>
    </div>
  </div>
  <script>
        // Onboarding wizard logic
        document.getElementById('onboard_submit').onclick = async function(e) {
          e.preventDefault();
          const status = document.getElementById('onboard_status');
          status.textContent = 'Submitting...';
          // Collect all onboarding fields
          const business = {
            name: document.getElementById('onboard_business_name').value,
            phone: document.getElementById('onboard_business_phone').value,
            email: document.getElementById('onboard_business_email').value,
            description: document.getElementById('onboard_business_desc').value
          };
          const brand = {
            name: document.getElementById('onboard_brand_name').value,
            tagline: document.getElementById('onboard_brand_tagline').value,
            website: document.getElementById('onboard_brand_website').value,
            social: document.getElementById('onboard_brand_social').value
          };
          const poc = {
            name: document.getElementById('onboard_poc_name').value,
            phone: document.getElementById('onboard_poc_phone').value,
            email: document.getElementById('onboard_poc_email').value
          };
          const logoFile = document.getElementById('onboard_brand_logo').files[0];
          // Basic validation
          if (!business.name || !business.phone) {
            status.textContent = 'Business name and phone are required.';
            return;
          }
          // Prepare form data
          const formData = new FormData();
          formData.append('business', JSON.stringify(business));
          formData.append('brand', JSON.stringify(brand));
          formData.append('poc', JSON.stringify(poc));
          if (logoFile) formData.append('logo', logoFile);
          // Submit to a new onboarding endpoint (to be handled in backend)
          try {
            const res = await fetch('/admin/tenant/onboard', {
              method: 'POST',
              body: formData
            });
            const data = await res.json();
            if (data && data.ok) {
              status.textContent = 'Onboarding submitted! Our team will review and activate your tenant.';
            } else {
              status.textContent = data.error || 'Submission failed.';
            }
          } catch (err) {
            status.textContent = 'Network or server error.';
          }
        };
    // ...existing code for form handling...
    const form = document.getElementById('uploadForm');
    const responseEl = document.getElementById('response');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      responseEl.textContent = 'Uploading...';
      const formData = new FormData();
      const adminKey = form.admin_key.value;
      const tenantPhone = form.tenant_phone.value;
      const tenantName = form.tenant_name.value;
      const productsJson = form.products_json.value;
      formData.append('tenant_phone', tenantPhone);
      formData.append('tenant_name', tenantName);
      formData.append('products_json', productsJson);
      const files = form.images.files;
      for (let i = 0; i < files.length; i++) {
        formData.append('images', files[i]);
      }
      const res = await fetch('/admin/catalog/upload', {
        method: 'POST',
        headers: { 'x-admin-key': adminKey },
        body: formData
      });
      const data = await res.json().catch(() => ({ error: 'Invalid response' }));
      responseEl.textContent = JSON.stringify(data, null, 2);
    });
    const csvForm = document.getElementById('csvForm');
    csvForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      responseEl.textContent = 'Importing CSV...';
      const formData = new FormData();
      const adminKey = csvForm.admin_key.value;
      const tenantPhone = csvForm.tenant_phone.value;
      const tenantName = csvForm.tenant_name.value;
      const csvFile = csvForm.catalog_csv.files[0];
      formData.append('tenant_phone', tenantPhone);
      formData.append('tenant_name', tenantName);
      formData.append('catalog_csv', csvFile);
      const res = await fetch('/admin/catalog/import-csv', {
        method: 'POST',
        headers: { 'x-admin-key': adminKey },
        body: formData
      });
      const data = await res.json().catch(() => ({ error: 'Invalid response' }));
      responseEl.textContent = JSON.stringify(data, null, 2);
    });
    const simpleForm = document.getElementById('simpleForm');
    simpleForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      responseEl.textContent = 'Uploading (simple)...';
      const formData = new FormData();
      const adminKey = simpleForm.admin_key.value;
      const tenantPhone = simpleForm.tenant_phone.value;
      const tenantName = simpleForm.tenant_name.value;
      formData.append('tenant_phone', tenantPhone);
      formData.append('tenant_name', tenantName);
      formData.append('name', simpleForm.name.value);
      formData.append('price', simpleForm.price.value);
      formData.append('stock_count', simpleForm.stock_count.value);
      formData.append('category', simpleForm.category.value);
      formData.append('tags', simpleForm.tags.value);
      formData.append('brand', simpleForm.brand.value);
      formData.append('description', simpleForm.description.value);
      formData.append('collection', simpleForm.collection.value);
      formData.append('collection_description', simpleForm.collection_description.value);
      const files = simpleForm.images.files;
      for (let i = 0; i < files.length; i++) {
        formData.append('images', files[i]);
      }
      const res = await fetch('/admin/catalog/simple', {
        method: 'POST',
        headers: { 'x-admin-key': adminKey },
        body: formData
      });
      const data = await res.json().catch(() => ({ error: 'Invalid response' }));
      responseEl.textContent = JSON.stringify(data, null, 2);
    });
  </script>
</body>
</html>
